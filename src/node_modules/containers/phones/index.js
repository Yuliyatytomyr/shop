import React, {Component} from "react";
import {connect} from 'react-redux';
import {Link} from "react-router-dom";

import {fetchPhones, loadMorePhones, addPhoneToBasket, fetchCategories} from 'actions';
import {getPhones} from 'selectors';
import Layout from 'containers/layout';

import './phones.scss'

class Phones extends Component{
    componentDidMount() {
        this.props.fetchPhones();
        this.props.fetchCategories()
    }

    renderPhone = (phone, index) => {
        const { description = '' } = phone;
        const {addPhoneToBasket} = this.props;
        const shortDescription = description.substr(0, 60);
        return (
            <div className='card-product col-12 col-md-6 col-lg-4' key={index}>
                <div>
                    <div className='thumbnail'>
                        <img
                            className="img-thumbnail"
                            src={phone.image}
                            alt={phone.name}
                        />
                    </div>
                    <div className='about'>
                        <div className='main-info'>
                            <h5>{phone.name}</h5>
                            <h5>{phone.price} $</h5>
                        </div>
                        <p className='short-description'>{shortDescription}...</p>
                        <div className='buttons'>
                            <button className='btn btn-catalog' onClick={() => addPhoneToBasket(phone.id)}>
                                Add to Cart
                            </button>
                            <Link
                                to={`/phone/${phone.id}`}
                                className='btn btn-catalog-static'
                            >
                                More Info
                            </Link>
                        </div>
                    </div>
                </div>
            </div>
        )
    };

    render() {
        const {phones, loadMorePhones} = this.props;
        return (
            <Layout>
                <div className='books row'>
                    {phones.map((phone, index) => this.renderPhone(phone, index))}
                </div>
                <div className='col-md-12'>
                    <button onClick={loadMorePhones} className='btn btn-catalog'>
                        Load More
                    </button>
                </div>
            </Layout>

        )
    }
}

const mapStateToProps = (state, ownProps) => ({
    phones: getPhones(state, ownProps)
});

const mapDispatchToProps = {
    fetchPhones,
    loadMorePhones,
    addPhoneToBasket,
    fetchCategories
};

export default connect(
    mapStateToProps,
    mapDispatchToProps
)(Phones)